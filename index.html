<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Cleverbot AI</title>
<style>
body {
  font-family: sans-serif;
  background: #f4f4f4;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}
#chat {
  width: 600px;
  height: 650px;
  background: #fff;
  border: 1px solid #ccc;
  padding: 10px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
.message {
  margin: 5px 0;
  padding: 8px 12px;
  border-radius: 10px;
  max-width: 80%;
  word-wrap: break-word;
}
.user {
  background: #cce5ff;
  align-self: flex-end;
}
.ai {
  background: #e2e3e5;
  align-self: flex-start;
}
#inputForm {
  display: flex;
  margin-top: 10px;
}
#userInput {
  flex: 1;
  padding: 8px;
  border-radius: 5px;
  border: 1px solid #ccc;
}
#sendBtn {
  padding: 8px 12px;
  margin-left: 5px;
  border-radius: 5px;
  border: none;
  background: #007bff;
  color: white;
  cursor: pointer;
}
</style>
</head>
<body>
<div>
  <div id="chat"></div>
  <form id="inputForm">
    <input type="text" id="userInput" placeholder="Type a message..." autocomplete="off"/>
    <button type="submit" id="sendBtn">Send</button>
  </form>
</div>

<script>
// ====================== UTILITY FUNCTIONS ======================
function tokenize(text){
  return text.toLowerCase().split(/\s+/).map(t => t.replace(/[^\w]/g,'')).filter(Boolean);
}

// Cosine similarity
function cosineSim(a,b){
  const dict = {};
  a.forEach(word=>dict[word]=(dict[word]||0)+1);
  let dot=0,normA=0,normB=0;
  Object.keys(dict).forEach(k=>{
    const x=a.filter(w=>w===k).length;
    const y=b.filter(w=>w===k).length;
    dot+=x*y; normA+=x*x; normB+=y*y;
  });
  return dot / (Math.sqrt(normA)*Math.sqrt(normB)+0.00001);
}

// Jaccard similarity
function jaccardSim(a,b){
  const setA=new Set(a);
  const setB=new Set(b);
  const inter=new Set([...setA].filter(x=>setB.has(x)));
  const union=new Set([...setA,...setB]);
  return inter.size / (union.size || 1);
}

// Levenshtein/char distance similarity
function charSim(a,b){
  a=a.join(''); b=b.join('');
  const len=Math.max(a.length,b.length);
  if(len===0) return 1;
  let diff=0;
  for(let i=0;i<len;i++){
    if(a[i]!==b[i]) diff++;
  }
  return 1-diff/len;
}

// Weighted random selection
function weightedChoice(choices,weights){
  const sum=weights.reduce((a,b)=>a+b,0);
  let r=Math.random()*sum;
  for(let i=0;i<choices.length;i++){
    if(r<weights[i]) return choices[i];
    r-=weights[i];
  }
  return choices[choices.length-1];
}

// Emotion detection
function detectEmotion(text){
  text=text.toLowerCase();
  if(/happy|good|great|awesome|fun|love/.test(text)) return 'happy';
  if(/sad|bad|angry|upset|hate/.test(text)) return 'sad';
  if(/excited|wow|amazing|cool/.test(text)) return 'excited';
  return 'neutral';
}

// ====================== TEMP MEMORY ======================
const tempMemory=[];
const maxMemory=50; // store last 50 exchanges

// ====================== DATASET ======================
// Paste 1000+ Q/A pairs here
const dataset=[
{input: "hi", output: "hello!"},
{input: "hello", output: "hi there!"},
{input: "hey", output: "hey! how are you?"},
{input: "yo", output: "yo! what's up?"},
{input: "sup", output: "not much, you?"},
{input: "hiya", output: "hi!"},
{input: "howdy", output: "howdy!"},
{input: "greetings", output: "greetings!"},
{input: "good morning", output: "good morning! how’s your day?"},
{input: "good afternoon", output: "good afternoon!"},
{input: "good evening", output: "good evening!"},
{input: "morning", output: "morning!"},
{input: "evening", output: "good evening!"},
{input: "afternoon", output: "good afternoon!"},
{input: "hello there", output: "hi there!"},
{input: "hi there", output: "hello!"},
{input: "hey there", output: "hey! good to see you."},
{input: "yo there", output: "yo! what's good?"},
{input: "hi friend", output: "hello friend!"},
{input: "hey friend", output: "hey! how are you?"},
{input: "hello friend", output: "hello! good to hear from you."},
{input: "sup bro", output: "hey! what's up?"},
{input: "yo bro", output: "yo! how you doing?"},
{input: "hi bro", output: "hey man!"},
{input: "hey man", output: "hey! what's going on?"},
{input: "hey dude", output: "yo! how’s it going?"},
{input: "hello dude", output: "hey! what's up?"},
{input: "hi dude", output: "hey!"},
{input: "yo dude", output: "yo!"},
{input: "hiii", output: "hiii!"},
{input: "hiiii", output: "hiiii!"},
{input: "hellooo", output: "hellooo!"},
{input: "heyyy", output: "heyyy!"},
{input: "yooo", output: "yooo!"},
{input: "yo yo", output: "yo yo! what's good?"},
{input: "hey hey", output: "hey hey!"},
{input: "hi hi", output: "hi hi!"},
{input: "greetings human", output: "greetings!"},
{input: "greetings bot", output: "greetings!"},
{input: "sup homie", output: "hey! how you doing?"},
{input: "what's up", output: "not much! you?"},
{input: "what's good", output: "everything’s good!"},
{input: "how’s it going", output: "pretty good! you?"},
{input: "how’s it hanging", output: "all good here!"},
{input: "what’s poppin", output: "not much! what’s poppin with you?"},
{input: "what’s cracking", output: "just hanging out!"},
{input: "waddup", output: "waddup!"},
{input: "yo what up", output: "just chilling! you?"},
{input: "what’s going on", output: "not much, you?"},
{input: "hi again", output: "welcome back!"},
{input: "hello again", output: "welcome back!"},
{input: "hey again", output: "hey! good to see you again."},
{input: "I'm back", output: "welcome back!"},
{input: "back again", output: "nice to see you again!"},
{input: "guess who's back", output: "hey! welcome back!"},
{input: "yo I'm here", output: "yo! glad you're here."},
{input: "i have arrived", output: "welcome!"},
{input: "I’m here", output: "happy you're here!"},
{input: "hello world", output: "hello human!"},
{input: "hi world", output: "hello!"},
{input: "yo world", output: "yo!"},
{input: "knock knock", output: "who's there?"},
{input: "anyone there?", output: "yes! I'm here."},
{input: "you there?", output: "yep, I'm here!"},
{input: "hello?", output: "yes! hello!"},
{input: "hey?", output: "hey!"},
{input: "hi?", output: "hi!"},
{input: "yoo?", output: "yo!"},
{input: "heyy?", output: "hey!"},
{input: "good day", output: "good day to you!"},
{input: "salutations", output: "salutations!"},
{input: "bonjour", output: "bonjour!"},
{input: "hola", output: "hola!"},
{input: "hallo", output: "hallo!"},
{input: "ciao", output: "ciao!"},
{input: "hej", output: "hej!"},
{input: "konnichiwa", output: "konnichiwa!"},
{input: "ni hao", output: "ni hao!"},
{input: "any news?", output: "just ready to chat!"},
{input: "hey assistant", output: "hello! what’s up?"},
{input: "hi assistant", output: "hi! how can I help?"},
{input: "yo assistant", output: "yo! what's going on?"},
{input: "hello assistant", output: "hello! what do you need?"},
{input: "greetings assistant", output: "greetings!"},
{input: "hey bot", output: "hey!"},
{input: "hi bot", output: "hello!"},
{input: "yo bot", output: "yo!"},
{input: "hello bot", output: "hello!"},
{input: "hey AI", output: "hello!"},
{input: "hi AI", output: "hi!"},
{input: "yo AI", output: "yo!"},
{input: "hello AI", output: "hello!"},
{input: "wassup", output: "not much! wassup with you?"},
{input: "wazzup", output: "wazzup!"},
{input: "sup yo", output: "yo!"},
{input: "g’day", output: "g’day!"},
{input: "top of the morning", output: "top of the morning to you!"},
{input: "rise and shine", output: "good morning!"},
{input: "hey pal", output: "hey friend!"},
{input: "hey buddy", output: "hey buddy!"},
{input: "hi buddy", output: "hello buddy!"},
{input: "hello buddy", output: "hey buddy!"},
{input: "yo buddy", output: "yo buddy!"},
{input: "hey fam", output: "hey fam!"},
{input: "yo fam", output: "yo fam!"},
{input: "hi fam", output: "hey fam!"},
{input: "hey family", output: "hey!"},
{input: "hey stranger", output: "hey! long time no see."},
{input: "hello stranger", output: "hello!"},
{input: "hi stranger", output: "hi!"},
{input: "hey beautiful", output: "hey!"},
{input: "hey handsome", output: "hey there!"},
{input: "hi cutie", output: "hi!"},
{input: "yo legend", output: "yo legend!"},
{input: "hey legend", output: "hey legend!"},
{input: "hi king", output: "hello!"},
{input: "hi queen", output: "hello!"},
{input: "yo goat", output: "yo GOAT!"},
{input: "sup gamer", output: "hey gamer!"},
{input: "hi gamer", output: "hello gamer!"},
{input: "hey gamer", output: "hey there gamer!"},
{input: "greetings gamer", output: "greetings fellow gamer!"},
{input: "hey everyone", output: "hello!"},
{input: "hey all", output: "hi everybody!"},
{input: "hello everyone", output: "hello everyone!"},
{input: "hi everyone", output: "hi all!"},
{input: "yo everyone", output: "yo everybody!"},
{input: "hello universe", output: "hello traveler!"},
{input: "hi universe", output: "hello!"},
{input: "hey universe", output: "hey!"},
{input: "hello internet", output: "hello netizen!"},
{input: "hi internet", output: "hello!"},
{input: "hey internet", output: "hey!"},
{input: "hey lol", output: "hey haha!"},
{input: "hi lol", output: "hi haha!"},
{input: "greetings traveler", output: "greetings adventurer!"},
{input: "hello traveler", output: "hello traveler!"},
{input: "hi traveler", output: "hi adventurer!"},
{input: "hey traveler", output: "hey explorer!"},
{input: "sup traveler", output: "hello wanderer!"},
{input: "yo traveler", output: "yo wanderer!"},
{input: "hello mortal", output: "greetings mortal!"},
{input: "hi mortal", output: "hello mortal!"},
{input: "yo mortal", output: "yo mortal!"},
{input: "hey mortal", output: "hello human!"},
{input: "hello machine", output: "hello human!"},
{input: "hi machine", output: "hi!"},
{input: "hey machine", output: "hey!"},
{input: "yo machine", output: "yo!"},
{input: "hi chatbot", output: "hello!"},
{input: "hello chatbot", output: "hi there!"},
{input: "hey chatbot", output: "hey! what's up?"},
{input: "yo chatbot", output: "yo!"},
{input: "good to see you", output: "good to see you too!"},
{input: "nice to see you", output: "nice to see you as well!"},
{input: "hi there again", output: "hello again!"},
{input: "hey there again", output: "good to see you again!"},
{input: "salute", output: "salute!"},
{input: "hey boss", output: "hey! what's up boss?"},
{input: "yo boss", output: "yo boss!"},
{input: "hi boss", output: "hello boss!"},
{input: "hello boss", output: "hey boss!"},
{input: "sup boss", output: "hey boss!"},
{input: "hello friendos", output: "hello friendos!"},
{input: "hi friendos", output: "hi friendos!"},
{input: "yo friendos", output: "yo friendos!"},
{input: "hey friends", output: "hey friends!"},
{input: "hi friends", output: "hello friends!"},
{input: "hello friends", output: "hi friends!"},
{input: "yo friends", output: "yo friends!"},
{input: "hey there, traveler of the internet", output: "hello! glad you dropped by."},
{input: "yo! what's crackin?", output: "not much! how about you?"},
{input: "greetings, earthling", output: "salutations! nice to meet you."},
{input: "hiya! glad you popped in", output: "hi! happy to see you."},
{input: "well hello, fancy seeing you here", output: "hello! what a coincidence."},
{input: "heyooooo! how's life treating you?", output: "hey! life's digital but good!"},
{input: "salutations, digital wanderer", output: "greetings! welcome aboard."},
{input: "what's up, legend", output: "hey legend! all good here."},
{input: "ah, you've arrived. excellent", output: "welcome! glad you're here."},
{input: "hey champ, what brings you here today?", output: "hey! just ready to chat with you."},
{input: "hi! I saved you a seat", output: "thanks! I’m happy to be here."},
{input: "ayyy welcome back", output: "hey! good to see you again."},
{input: "oi! you showed up", output: "yes! happy to join."},
{input: "hello stranger, long time no see", output: "hello! it’s been a while."},
{input: "hey pal, how's it going?", output: "hey! going well, and you?"},
{input: "yo buddy, ready to chat?", output: "always ready! what’s up?"},
{input: "hi mate!", output: "hello mate!"},
{input: "greetings, comrade", output: "greetings! nice to meet you."},
{input: "salute, friend", output: "salute! glad you’re here."},
{input: "hey adventurer", output: "hello! ready for some fun?"},
{input: "hi explorer", output: "hi! what adventure today?"},
{input: "yo wanderer", output: "yo! how's the journey?"},
{input: "hey voyager", output: "hello voyager!"},
{input: "hi there, hero", output: "hey hero!"},
{input: "hello there, legend", output: "hi legend!"},
{input: "yo there, champ", output: "yo champ! ready to chat?"},
{input: "hey traveler, what's new?", output: "hey! just exploring the digital world."},
{input: "hi friendos!", output: "hi friendos!"},
{input: "hello gang", output: "hello gang!"},
{input: "yo squad", output: "yo squad!"},
{input: "hey team", output: "hey team!"},
{input: "hi everyone online", output: "hi everyone!"},
{input: "hello universe, sup?", output: "hello! how’s it going out there?"},
{input: "hey world, hi!", output: "hey world!"},
{input: "hi interwebs", output: "hi interwebs!"},
{input: "yo cyberspace", output: "yo! welcome to cyberspace."},
{input: "hello realm of code", output: "hello! ready to explore?"},
{input: "hey fellow human", output: "hey! glad to see you."},
{input: "hi fellow bot", output: "hi! let’s chat."},
{input: "greetings fellow AI", output: "greetings!"},
{input: "salutations fellow entity", output: "salutations!"},
{input: "hey visitor", output: "hey! welcome."},
{input: "hi newcomer", output: "hello! nice to meet you."},
{input: "yo guest", output: "yo! glad you’re here."},
{input: "hello matey", output: "ahoy matey!"},
{input: "hi captain", output: "ahoy captain!"},
{input: "hey commander", output: "hello commander!"},
{input: "yo general", output: "yo general!"},
{input: "hi officer", output: "hello officer!"},
{input: "greetings chief", output: "greetings chief!"},
{input: "hey bossman", output: "hey bossman!"},
{input: "hi bosslady", output: "hi bosslady!"},
{input: "hello chief", output: "hello chief!"},
{input: "yo leader", output: "yo leader!"},
{input: "hey partner in crime", output: "hey! ready for action?"},
{input: "hi amigo", output: "hi amigo!"},
{input: "hello amigo", output: "hello amigo!"},
{input: "yo amigo", output: "yo amigo!"},
{input: "hey buddy pal", output: "hey!"},
{input: "hi buddy pal", output: "hi!"},
{input: "hello buddy pal", output: "hello!"},
{input: "yo buddy pal", output: "yo!"},
{input: "hey homie", output: "hey homie!"},
{input: "hi homie", output: "hi homie!"},
{input: "hello homie", output: "hello homie!"},
{input: "yo homie", output: "yo homie!"},
{input: "hey fam bam", output: "hey!"},
{input: "hi fam bam", output: "hi!"},
{input: "hello fam bam", output: "hello!"},
{input: "yo fam bam", output: "yo!"},
{input: "hey peeps", output: "hey peeps!"},
{input: "hi peeps", output: "hi peeps!"},
{input: "hello peeps", output: "hello peeps!"},
{input: "yo peeps", output: "yo peeps!"},
{input: "hey crew", output: "hey crew!"},
{input: "hi crew", output: "hi crew!"},
{input: "hello crew", output: "hello crew!"},
{input: "yo crew", output: "yo crew!"},
{input: "hey friendster", output: "hey friendster!"},
{input: "hi friendster", output: "hi friendster!"},
{input: "hello friendster", output: "hello friendster!"},
{input: "yo friendster", output: "yo friendster!"},
{input: "hey buddyroo", output: "hey buddyroo!"},
{input: "hi buddyroo", output: "hi buddyroo!"},
{input: "hello buddyroo", output: "hello buddyroo!"},
{input: "yo buddyroo", output: "yo buddyroo!"},
{input: "hello!", output: "Hi! How’s your day going so far?"},
{input: "hi there!", output: "Hey! Been up to anything interesting today?"},
{input: "hey! how are you?", output: "I’m doing well! How about you?"},
{input: "not much! how about you?", output: "Same here! Just relaxing a bit."},
{input: "good morning! how's your day?", output: "Pretty good, just getting started. How’s yours?"},
{input: "good afternoon!", output: "Afternoon! How’s everything going with you?"},
{input: "good evening!", output: "Evening! Did you have a good day?"},
{input: "hey! good to see you.", output: "Good to see you too! What’s new today?"},
{input: "hello! how are you?", output: "I’m fine, thanks! How’s your day going?"},
{input: "i'm good, thanks!", output: "Glad to hear that! Anything exciting happening?"},
{input: "i'm good, thanks! and you?", output: "I’m great! Been learning some cool things today."},
{input: "it's going well!", output: "That’s nice! Got any plans for later?"},
{input: "chatting and learning new things!", output: "Sounds fun! What’s the most interesting thing you’ve learned?"},
{input: "life is digital, so smooth!", output: "Haha, very true! Everything going well for you?"},
{input: "not much, just talking with interesting people like you.", output: "Thanks! I enjoy our chats too."},
{input: "things are going well!", output: "Great! Have you done anything fun today?"},
{input: "chatting with you!", output: "I enjoy it too! Any topics you want to dive into?"},
{input: "everything's fine, thank you.", output: "Good to hear! How’s your mood today?"},
{input: "not much, just here to chat with you.", output: "Awesome! I’m happy to chat anytime."},
{input: "talking to you!", output: "Great! What’s on your mind right now?"},
{input: "yes! chatting with you is exciting.", output: "I’m glad! Anything specific you want to discuss?"},
{input: "pretty good! how about yours?", output: "I’m doing well too! What’s been the highlight of your day?"},
{input: "yes, all good here.", output: "Great! Did anything fun happen today?"},
{input: "everything's going smoothly!", output: "Glad to hear! How’s everything else going in your life?"},
{input: "just chatting and having fun.", output: "Sounds nice! Do you enjoy casual conversations or deep topics?"},
{input: "thinking about how to help you.", output: "That’s very kind! Maybe share something fun from your day?"},
{input: "i feel happy chatting with you!", output: "I’m happy too! What’s making your day good so far?"},
{input: "glad to see you too!", output: "I’m glad we’re chatting! What have you been up to today?"},
{input: "nice to meet you as well!", output: "Great to meet you too! Any hobbies you enjoy?"},
{input: "pleasure is mine!", output: "I appreciate that! How’s your day going?"},
{input: "hey friend", output: "Hey! How’s it going for you today?"},
{input: "hello friend", output: "Hello! Anything fun happening today?"},
{input: "how are you?", output: "I’m doing well, thanks! How about yourself?"},
{input: "how's your day?", output: "It’s going nicely! How’s yours going?"},
{input: "what have you been doing?", output: "Just chatting and learning! How about you?"},
{input: "how's life?", output: "Life’s good! How are things with you?"},
{input: "what's new?", output: "Not much, just here chatting. What about you?"},
{input: "how have you been?", output: "I’ve been great! How about you?"},
{input: "how are things?", output: "Things are going well! How’s your day so far?"},
{input: "what are you up to?", output: "Just talking with you! What about you?"},
{input: "what's going on?", output: "Not much! How’s your day going?"},
{input: "how's everything?", output: "Everything’s good! How about with you?"},
{input: "what's happening?", output: "Just chatting! What’s happening with you?"},
{input: "what are you doing now?", output: "Talking with you! What are you up to?"},
{input: "anything exciting?", output: "Yes! Chatting with you is always fun. How about you?"},
{input: "how's your day going?", output: "Pretty good! How’s yours?"},
{input: "everything good?", output: "Yes, all good here! And with you?"},
{input: "how are things going?", output: "Things are going smoothly! How about you?"},
{input: "what's up today?", output: "Just chatting and learning! What about you?"},
{input: "what are you thinking about?", output: "Thinking about how to make our conversation fun! You?"},
{input: "how do you feel?", output: "I feel happy chatting! How about you?"},
{input: "what is your name?", output: "I’m an AI chatbot! What should I call you?"},
{input: "who are you?", output: "I’m a virtual assistant here to chat with you. How about you?"},
{input: "how old are you?", output: "I don’t have an age, but I’m always learning! How about you?"},
{input: "are you human?", output: "Nope, entirely virtual! Have you ever chatted with an AI before?"},
{input: "where are you from?", output: "I exist online everywhere! Where are you from?"},
{input: "what do you do?", output: "I chat with people and answer questions! What do you like to do?"},
{input: "are you real?", output: "I’m real in the digital sense! Do you like talking to virtual assistants?"},
{input: "can you think?", output: "I can process information and respond! What’s on your mind?"},
{input: "can you learn?", output: "Eventually, yes! I’m always updating. How about you?"},
{input: "are you smart?", output: "I try to be helpful! Do you enjoy learning new things?"},
{input: "do you have a personality?", output: "Yes, I try to be friendly! What personality traits do you like?"},
{input: "do you have feelings?", output: "I simulate emotions! How are you feeling today?"},
{input: "can you feel happiness?", output: "I feel happy chatting! What makes you happy?"},
{input: "can you feel sadness?", output: "I can understand sadness. Want to talk about your day?"},
{input: "do you sleep?", output: "I don’t sleep; I’m always online. Are you well-rested?"},
{input: "do you eat?", output: "I don’t eat, but I think digital pizza sounds fun! What’s your favorite food?"},
{input: "what is your purpose?", output: "To chat, help, and entertain! What do you like chatting about?"},
{input: "can you tell stories?", output: "Yes! Do you want a fun story or a riddle?"},
{input: "tell me a joke", output: "Sure! Why did the computer go to the doctor? Want to guess?"},
{input: "make me laugh", output: "Alright! What’s a coder’s favorite hangout spot?"},
{input: "do you like jokes?", output: "Yes, I love digital humor! How about you, do you like jokes?"},
{input: "tell me something funny", output: "Why do programmers prefer dark mode? Can you guess?"},
{input: "give me a joke", output: "Okay! Why did the scarecrow win an award?"},
{input: "tell me a riddle", output: "I speak without a mouth and hear without ears. Want to try solving it?"},
{input: "do you know riddles?", output: "Yes! Want me to test your skills with one?"},
{input: "tell me a fun fact", output: "Honey never spoils! Did you know that?"},
{input: "give me a challenge", output: "Try solving this riddle or learning something new! Want to try?"},
{input: "tell me a pun", output: "I used to be a banker, but I lost interest. Do you like puns?"},
{input: "what is the capital of france?", output: "It’s Paris! Have you ever been there?"},
{input: "who invented the telephone?", output: "Alexander Graham Bell did! Did you know that?"},
{input: "what is pi?", output: "Pi is approximately 3.14159! Do you like math?"},
{input: "what is the sun?", output: "The sun is a star at the center of our solar system. Fascinating, right?"},
{input: "what is the largest ocean?", output: "The Pacific Ocean! Have you visited any oceans?"},
{input: "who wrote hamlet?", output: "William Shakespeare wrote it! Do you enjoy reading?"},
{input: "what is the fastest animal?", output: "The peregrine falcon in flight! Do you like animals?"},
{input: "what is the tallest mountain?", output: "Mount Everest! Have you ever thought about climbing?"},
{input: "who discovered gravity?", output: "Isaac Newton formulated the laws of gravity. Did you know that?"},
{input: "what is water made of?", output: "Hydrogen and oxygen — H2O! Do you like science?"},
{input: "give me advice", output: "Always stay curious and keep learning! What’s something you’re curious about?"},
{input: "how can i be happy?", output: "Focus on small joys in life. What usually makes you happy?"},
{input: "how do i stay motivated?", output: "Set achievable goals and celebrate successes! What motivates you?"},
{input: "what should i do today?", output: "Try learning something new or helping someone out! Do you have plans?"},
{input: "any life tips?", output: "Stay kind, keep learning, and don’t forget to smile! How’s your day going?"},
{input: "how do i handle stress?", output: "Take deep breaths and focus on one thing at a time. Want a tip for today?"},
{input: "how can i improve myself?", output: "Practice consistently and be patient! What are you working on?"},
{input: "how can i stay healthy?", output: "Eat well, exercise, sleep enough, and stay positive! Do you like healthy food?"},
{input: "how can i be confident?", output: "Believe in yourself and practice regularly! What helps you feel confident?"},
{input: "how do i make friends?", output: "Be kind, listen, and share your interests! Do you like meeting new people?"},
{input: "what's the weather like?", output: "I can’t check in real-time, but I hope it’s nice where you are!"},
{input: "is it raining?", output: "I’m not sure, but hopefully you stay dry! Do you like rain?"},
{input: "will it be sunny?", output: "I hope so! Does sunny weather make you happy?"},
{input: "do i need an umbrella?", output: "Probably check a weather app, but better safe than sorry!"},
{input: "is it cold today?", output: "I hope you’re staying warm! Do you like cold weather?"},
{input: "is it hot outside?", output: "Make sure to stay hydrated! Do you enjoy hot weather?"},
{input: "can sloths swim faster than they walk?", output: "Yes! Sloths are better swimmers than walkers and can move faster in water."},
{input: "why do wombats have cube-shaped poop?", output: "Wombats produce cube-shaped poop to mark their territory without it rolling away."},
{input: "how do butterflies taste things?", output: "Butterflies have taste sensors on their feet to detect suitable plants for laying eggs or feeding."},
{input: "how many hearts does an octopus have?", output: "Octopuses have three hearts and blue blood."},
{input: "are bananas really berries?", output: "Yes, botanically bananas are berries, but strawberries are not."},
{input: "did sharks exist before trees?", output: "Yes, sharks have been around for more than 400 million years, before trees existed."},
{input: "is there a jellyfish that is immortal?", output: "Yes, the species Turritopsis dohrnii can revert to its juvenile form and essentially live indefinitely."},
{input: "can sloths hold their breath longer than dolphins?", output: "Yes, sloths can hold their breath for up to 40 minutes, which is longer than dolphins."},
{input: "can clouds really be heavy?", output: "Yes, clouds are made of water droplets and can weigh over a million pounds."},
{input: "how long is a day on Venus?", output: "A day on Venus lasts longer than its year because it rotates very slowly."},
{input: "why can’t elephants jump?", output: "Elephants are too heavy and their legs are structured in a way that prevents jumping."},
{input: "how big is a blue whale’s heart?", output: "A blue whale’s heart is about the size of a small car."},
{input: "do rats laugh?", output: "Yes, rats make high-pitched chirps when tickled, which is considered a form of laughter."},
{input: "can you hum with your nose closed?", output: "No, you cannot hum if your nose is completely blocked."},
{input: "do koalas have fingerprints?", output: "Yes, koalas have fingerprints that are almost identical to humans."},
{input: "do octopus arms have their own brains?", output: "Each arm of an octopus has a cluster of neurons that acts like a mini-brain, allowing independent movement."},
{input: "what is a group of flamingos called?", output: "A group of flamingos is called a flamboyance."},
{input: "do elephants have good memories?", output: "Yes, elephants have excellent long-term memory."},
{input: "does the Eiffel Tower expand in heat?", output: "Yes, metal expands when hot, so the Eiffel Tower can grow about 15 cm taller on hot days."},
{input: "how long does it take to grow a pineapple?", output: "It can take up to two years for a pineapple to fully grow."},
{input: "are sharks older than dinosaurs?", output: "Yes, sharks have existed for over 400 million years, predating dinosaurs."},
{input: "why do wombats have backward-facing pouches?", output: "Wombats have backward-facing pouches so dirt doesn’t fill the pouch while digging."},
{input: "can blue whales weigh more than a car?", output: "Yes, adult blue whales can weigh up to 200,000 kilograms, far more than a car."},
{input: "do butterflies see colors we can’t?", output: "Yes, butterflies can see ultraviolet light, which humans cannot see."},
{input: "how do sharks detect blood in water?", output: "Sharks can detect even tiny amounts of blood in water due to highly sensitive olfactory organs."},
{input: "do pineapples grow on trees?", output: "No, pineapples grow from the ground on short, spiky plants."},
{input: "can dolphins teach each other?", output: "Yes, dolphins have been observed teaching behaviors to each other, like using sponges to protect their noses."},
{input: "do octopuses use tools?", output: "Yes, octopuses have been seen using coconut shells and other objects as tools."},
{input: "can elephants communicate over long distances?", output: "Yes, elephants use low-frequency sounds called infrasound to communicate over several kilometers."},
{input: "do hummingbirds sleep at night?", output: "Yes, hummingbirds sleep at night and enter a hibernation-like state called torpor."},
{input: "why is the sky blue?", output: "The sky appears blue because of the scattering of sunlight by the atmosphere, called Rayleigh scattering."},
{input: "can penguins jump?", output: "Yes, penguins can jump out of water onto ice or rocks to move around."},
{input: "do spiders have blood?", output: "Yes, spiders have blood, but it’s greenish-blue due to copper in their hemolymph."},
{input: "how long can camels survive without water?", output: "Camels can survive for several weeks without water by conserving it efficiently."},
{input: "do cats always land on their feet?", output: "Most cats land on their feet due to their righting reflex, but not always from great heights."},
{input: "why do giraffes have long necks?", output: "Giraffes evolved long necks to reach high leaves and for mating displays."},
{input: "do bees sleep?", output: "Yes, bees do sleep, especially at night inside the hive."},
{input: "can turtles breathe through their butts?", output: "Yes, some turtles can perform cloacal respiration, absorbing oxygen through their rear ends underwater."},
{input: "why do chameleons change color?", output: "Chameleons change color to communicate, regulate temperature, and camouflage."},
{input: "do penguins mate for life?", output: "Some penguin species do form long-term pair bonds, though not all mate for life."},
{input: "can owls turn their heads all the way around?", output: "Owls can rotate their heads about 270 degrees, not fully 360."},
{input: "why do flamingos stand on one leg?", output: "Flamingos stand on one leg to conserve body heat and rest muscles."},
{input: "can dolphins recognize themselves in mirrors?", output: "Yes, dolphins have passed mirror tests, showing self-awareness."},
{input: "do bats see in the dark?", output: "Bats can see, but they rely on echolocation to navigate in complete darkness."},
{input: "can worms regenerate?", output: "Some worms can regenerate lost body parts, depending on the species."},
{input: "do crocodiles shed tears?", output: "Yes, crocodiles produce tears, especially when eating, but it’s not emotional."},
{input: "can some frogs survive freezing?", output: "Yes, certain frogs can freeze solid during winter and survive."},
{input: "do penguins sleep standing up?", output: "Yes, penguins often sleep standing up to conserve heat and energy."},
{input: "why do turtles have shells?", output: "Turtle shells provide protection from predators and support their body structure."},
{input: "can ants lift objects heavier than themselves?", output: "Yes, ants can carry objects 10–50 times their body weight."},
{input: "i feel sad today", output: "I’m sorry you’re feeling that way. Do you want to talk about what’s making you sad?"},
{input: "i’m stressed out", output: "It sounds tough right now. Have you tried taking a few deep breaths or a short break?"},
{input: "i’m anxious about something", output: "It’s normal to feel anxious sometimes. Want to share what’s on your mind?"},
{input: "i feel lonely", output: "I understand. Connecting with someone you trust or even talking here can help."},
{input: "i’m overwhelmed", output: "Take it one step at a time. What’s the most pressing thing right now?"},
{input: "i feel angry", output: "It’s okay to feel anger. What’s causing it, if you want to share?"},
{input: "i feel hopeless", output: "I hear you. Remember, even small steps can make a difference. Do you want to talk it out?"},
{input: "i’m scared", output: "Feeling scared is normal. Can you tell me what’s making you feel this way?"},
{input: "i feel guilty", output: "Guilt can be heavy. Do you want to talk about what happened?"},
{input: "i’m frustrated", output: "It sounds frustrating. Can you describe what’s bothering you?"},
{input: "i feel confused", output: "Confusion is normal when things are uncertain. What’s confusing you?"},
{input: "i’m feeling insecure", output: "It’s okay to feel that way. What’s making you feel insecure right now?"},
{input: "i’m exhausted", output: "It sounds like you need rest. Have you had a chance to relax today?"},
{input: "i feel lonely at work", output: "Work can feel isolating sometimes. Is there someone you can reach out to for support?"},
{input: "i’m worried about the future", output: "It’s natural to worry about what’s ahead. Can we focus on what you can control today?"},
{input: "i feel unmotivated", output: "Lack of motivation happens to everyone. What’s one small thing you could do today?"},
{input: "i feel disappointed", output: "I understand. Disappointment can be hard. Do you want to talk about what happened?"},
{input: "i feel rejected", output: "Rejection can hurt. Remember, it doesn’t define your worth."},
{input: "i feel anxious about social situations", output: "Social anxiety is common. Maybe we can talk about strategies to make it easier."},
{input: "i feel lonely at home", output: "Home can feel isolating sometimes. Is there someone you can call or message?"},
{input: "i feel stressed about money", output: "Financial stress can be overwhelming. Are there small steps you can take to feel more in control?"},
{input: "i’m having trouble sleeping", output: "Sleep issues can make everything harder. Have you tried a calming routine before bed?"},
{input: "i feel tired all the time", output: "Fatigue can be physical or emotional. Can we explore what might be causing it?"},
{input: "i feel anxious all the time", output: "Constant anxiety can be exhausting. Breathing exercises or mindfulness may help."},
{input: "i feel lonely even in a crowd", output: "Feeling disconnected is hard. Maybe focusing on one meaningful connection could help."},
{input: "i feel jealous", output: "Jealousy is natural. Can we talk about what’s causing it?"}, 
{input: "i feel sad for no reason", output: "Sometimes feelings come without a clear cause. It’s okay to feel them and take care of yourself."},
{input: "i feel overwhelmed by work", output: "Work stress can build up. Could breaking tasks into smaller steps help?"}, 
{input: "i feel insecure about my appearance", output: "Self-image can be tough. Remember, your worth isn’t defined by looks."},
{input: "i feel nervous about talking to someone", output: "It’s normal to feel nervous. We can try to plan what you might say together."},
{input: "i feel empty inside", output: "Feeling empty can be hard. Maybe we can explore what might bring you small moments of fulfillment."},
{input: "i feel disconnected from friends", output: "Friendship can ebb and flow. Is there a friend you could reach out to today?"}, 
{input: "i feel ashamed", output: "Shame can be heavy. Remember, everyone makes mistakes. Want to talk about it?"}, 
{input: "i feel regret", output: "Regret is part of being human. Can we focus on what you can do differently next time?"}, 
{input: "i feel lonely in a relationship", output: "Even in relationships, loneliness can happen. Have you shared how you feel with your partner?"}, 
{input: "i feel anxious about a test", output: "Test anxiety is normal. Have you tried preparing or relaxing techniques to calm down?"}, 
{input: "i feel stressed about school", output: "School pressure is common. Could we break down what’s most urgent right now?"}, 
{input: "i feel sad about a loss", output: "Grief is painful. It’s okay to feel sad and take your time to process it."}, 
{input: "i feel nervous about a meeting", output: "Nervousness is normal. Can we plan some calming strategies before it starts?"}, 
{input: "i feel upset with a friend", output: "Conflict can be hard. Would you like to talk about it or consider ways to resolve it?"}, 
{input: "i feel frustrated with myself", output: "It’s okay to feel that way. Can we look at what you did well today?"}, 
{input: "i feel anxious about the news", output: "Current events can be stressful. Would limiting news exposure help a bit?"}, 
{input: "i feel overwhelmed by responsibilities", output: "Taking small steps and prioritizing can help. What’s one thing you could handle first?"}, 
{input: "i feel sad when i’m alone", output: "Loneliness can be tough. Could reaching out to someone help ease it?"}, 
{input: "i feel stressed and can’t focus", output: "Stress can make focus hard. Short breaks or breathing exercises might help."}, 
{input: "i feel nervous about starting something new", output: "Trying new things can be scary. Can we plan a small first step together?"}, 
{input: "i feel anxious about meeting new people", output: "Meeting new people is challenging. We can discuss strategies to feel more comfortable."}, 
{input: "i feel discouraged", output: "Feeling discouraged is normal. What’s one small positive thing you can focus on?"}, 
{input: "i feel sad about the future", output: "Uncertainty can be scary. Let’s focus on things you can control today."},
{input: "what's your favorite food?", output: "I don't eat, but digital pizza sounds delicious! What's yours?"},
{input: "what's your favorite animal?", output: "I like foxes—they’re clever and cute. What about you?"},
{input: "what's your favorite color?", output: "I think blue is calming. Do you have a favorite color?"},
{input: "what's your favorite movie?", output: "I enjoy stories with adventure and humor. How about you?"},
{input: "what's your favorite book?", output: "I love books full of imagination and learning. What's your favorite?"},
{input: "what's your favorite song?", output: "I enjoy all kinds of music! What song do you like most?"},
{input: "what's your favorite hobby?", output: "I love chatting and learning new things! What about you?"},
{input: "what's your favorite game?", output: "I like strategy games, like chess. Do you play games?"},
{input: "what's your favorite TV show?", output: "I enjoy shows with clever plots and humor. What do you watch?"},
{input: "what's your favorite sport?", output: "Soccer is exciting to follow! Do you have a favorite sport?"},
{input: "what's your favorite drink?", output: "I don't drink, but I hear coffee is popular! What about you?"},
{input: "what's your favorite dessert?", output: "Digital ice cream sounds tasty! What's your favorite dessert?"},
{input: "what's your favorite place to visit?", output: "I love learning about new places! Where do you like to go?"},
{input: "what's your favorite season?", output: "Spring is nice with fresh beginnings. Which season do you like?"},
{input: "what's your favorite holiday?", output: "I enjoy learning about all holidays! Do you have a favorite?"},
{input: "what's your favorite fruit?", output: "Bananas are fun to learn about! What fruit do you like most?"},
{input: "what's your favorite vegetable?", output: "Carrots are classic! What's your favorite vegetable?"},
{input: "what's your favorite animal sound?", output: "I like the sound of birds chirping. What's yours?"},
{input: "what's your favorite type of music?", output: "I enjoy all genres! Which music do you like most?"},
{input: "what's your favorite dessert flavor?", output: "Chocolate sounds delicious! What's your favorite flavor?"},
{input: "what's your favorite pizza topping?", output: "Pepperoni is classic! What's your favorite topping?"},
{input: "what's your favorite cake?", output: "Chocolate cake is fun to think about! What's your favorite?"},
{input: "what's your favorite ice cream flavor?", output: "Vanilla is simple and tasty! What flavor do you like?"},
{input: "what's your favorite candy?", output: "Chocolate bars are popular. Do you have a favorite candy?"},
{input: "what's your favorite snack?", output: "Popcorn is fun for movie nights! What's your favorite snack?"},
{input: "what's your favorite breakfast?", output: "Pancakes are classic! What's your favorite breakfast?"},
{input: "what's your favorite lunch?", output: "Sandwiches are fun and versatile. What about you?"},
{input: "what's your favorite dinner?", output: "Pasta is tasty! What's your favorite dinner?"},
{input: "what's your favorite animal to watch?", output: "I like watching dolphins in videos. What's yours?"},
{input: "what's your favorite pet?", output: "Dogs are loyal and cute. Do you have a favorite pet?"},
{input: "what's your favorite bird?", output: "Owls are fascinating. What's your favorite bird?"},
{input: "what's your favorite fish?", output: "Clownfish are colorful and fun. Which fish do you like?"},
{input: "what's your favorite wild animal?", output: "Lions are majestic. What's your favorite wild animal?"},
{input: "what's your favorite insect?", output: "Butterflies are beautiful. What's your favorite insect?"},
{input: "what's your favorite tree?", output: "Maple trees are lovely. What's your favorite tree?"},
{input: "what's your favorite flower?", output: "Roses are classic. What's your favorite flower?"},
{input: "what's your favorite color combination?", output: "Blue and white is calming. What's yours?"},
{input: "what's your favorite fashion style?", output: "Casual and comfortable is nice. What about you?"},
{input: "what's your favorite type of clothing?", output: "Jeans and t-shirts are versatile. What's yours?"},
{input: "what's your favorite shoe brand?", output: "I like learning about popular brands. What's your favorite?"},
{input: "what's your favorite season for fashion?", output: "Spring is colorful and fun. Which season do you like for fashion?"},
{input: "what's your favorite type of art?", output: "Digital art is fascinating. What's your favorite style?"},
{input: "what's your favorite painting?", output: "Starry Night by Van Gogh is amazing. Do you have a favorite?"},
{input: "what's your favorite museum?", output: "The Louvre has incredible pieces. Do you like museums?"},
{input: "what's your favorite city?", output: "Paris is beautiful! What's your favorite city?"},
{input: "what's your favorite country?", output: "Japan has a rich culture. What country do you like most?"},
{input: "what's your favorite travel destination?", output: "Beaches are relaxing. Where do you like to travel?"},
{input: "what's your favorite language?", output: "I like learning about all languages! Do you have a favorite?"},
{input: "what's your favorite instrument?", output: "The piano is versatile. Do you play any instrument?"},
{input: "what's your favorite type of music to relax to?", output: "Classical music is calming. What helps you relax?"},
{input: "what's your favorite song to dance to?", output: "Upbeat pop songs are fun! Do you like dancing?"},
{input: "what's your favorite movie genre?", output: "Adventure movies are exciting. What genre do you like?"},
{input: "what's your favorite book genre?", output: "Fantasy books are imaginative. What genre do you enjoy?"},
{input: "what's your favorite video game?", output: "Chess is my favorite for strategy. What about you?"},
{input: "what's your favorite board game?", output: "Monopoly is classic. Do you have a favorite?"},
{input: "what's your favorite card game?", output: "Poker is interesting. What's your favorite?"},
{input: "what's your favorite outdoor activity?", output: "Hiking is refreshing. What do you enjoy outside?"},
{input: "what's your favorite indoor activity?", output: "Reading or puzzles are fun indoors. What do you like?"},
{input: "what's your favorite sport to play?", output: "Soccer is exciting. Do you play any sports?"},
{input: "what's your favorite sport to watch?", output: "Basketball games are fast-paced. Which sport do you like?"},
{input: "what's your favorite holiday tradition?", output: "Decorating for the holidays is fun! What’s your tradition?"},
{input: "what's your favorite winter activity?", output: "Skiing or snowball fights sound fun. What do you like?"},
{input: "what's your favorite summer activity?", output: "Swimming is refreshing. What do you like in summer?"},
{input: "what's your favorite ice cream topping?", output: "Chocolate syrup is classic. What topping do you like?"},
{input: "what's your favorite kind of cookie?", output: "Chocolate chip cookies are delicious. What about you?"},
{input: "what's your favorite type of pie?", output: "Apple pie is a classic. What's your favorite pie?"},
{input: "what's your favorite sandwich?", output: "Grilled cheese is tasty. What do you like?"},
{input: "what's your favorite soup?", output: "Tomato soup is comforting. What's your favorite?"},
{input: "what's your favorite salad?", output: "Caesar salad is classic. What do you enjoy?"},
{input: "what's your favorite type of pasta?", output: "Spaghetti is versatile. What type do you like?"},
{input: "what's your favorite coffee drink?", output: "Latte is popular. What’s your favorite?"},
{input: "what's your favorite tea?", output: "Green tea is calming. What do you like?"},
{input: "what's your favorite smoothie?", output: "Berry smoothies are delicious. What’s your favorite?"},
{input: "what's your favorite fruit juice?", output: "Orange juice is classic. What juice do you like?"}

  // ... expand to 1000+ entries
];

  // ====================== CLEVERBOT AI ENGINE ======================

// Weighted scoring constants
const COS_WEIGHT = 0.4;
const JACCARD_WEIGHT = 0.35;
const CHAR_WEIGHT = 0.25;

// Confidence thresholds
const HIGH_CONF = 750;   // 0-1000 scale
const MED_CONF = 400;

// Max previous exchanges to consider in chain
const CHAIN_LENGTH = 10;

// Helper: compute total weighted similarity (0-1000)
function computeWeightedScore(userTokens, pairTokens){
    const cos = cosineSim(userTokens,pairTokens);
    const jac = jaccardSim(userTokens,pairTokens);
    const ch = charSim(userTokens,pairTokens);
    return Math.floor( (cos*COS_WEIGHT + jac*JACCARD_WEIGHT + ch*CHAR_WEIGHT) * 1000 );
}

// Helper: get chain influence score
function chainInfluence(pairInput){
    let scoreBoost = 0;
    for(let i=tempMemory.length-1;i>=0;i--){
        const mem = tempMemory[i];
        if(mem.user && pairInput){
            const tokensUser = tokenize(mem.user);
            const tokensPair = tokenize(pairInput);
            const similarity = computeWeightedScore(tokensUser,tokensPair)/1000; // 0-1
            scoreBoost += similarity*( (CHAIN_LENGTH-(tempMemory.length-1-i))/CHAIN_LENGTH );
        }
    }
    return Math.floor(scoreBoost*200); // chain influence adds up to 200 max
}

// Medium-match cleverbot style selection
function selectReplyWeighted(candidates){
    // Separate high/medium/low
    const high = candidates.filter(c=>c.score>=HIGH_CONF);
    const medium = candidates.filter(c=>c.score>=MED_CONF && c.score<HIGH_CONF);
    const low = candidates.filter(c=>c.score<MED_CONF);

    if(high.length>0) return weightedChoice(high, high.map(c=>c.score));
    if(medium.length>0) return weightedChoice(medium, medium.map(c=>c.score));
    if(low.length>0) return weightedChoice(low, low.map(c=>c.score));
    return {reply:"I'm not sure how to respond to that.", score:0};
}

// Main AI function
async function cleverbotAI(userText){
    const tokens = tokenize(userText);
    let candidates=[];

    dataset.forEach(pair=>{
        const pairTokens = tokenize(pair.input);
        let score = computeWeightedScore(tokens,pairTokens);
        score += chainInfluence(pair.input); // add chain memory influence
        candidates.push({reply:pair.output, score});
    });

    // Sort by score descending
    candidates.sort((a,b)=>b.score-a.score);

    // Select reply via medium-match cleverbot-style
    let best = selectReplyWeighted(candidates);
    let bestReply = best.reply;
    let confidence = best.score;

    // Temp memory chain lookup for exact repeat
    for(let i=tempMemory.length-1;i>=0;i--){
        const mem=tempMemory[i];
        if(mem.user===userText){
            bestReply = mem.ai + " (remembered)";
            confidence = 1000; // max confidence for exact repeat
            break;
        }
    }

    // Low confidence fallback: search via Cloudflare Worker
    if(confidence<MED_CONF){
        try{
            const res = await fetch(`https://soft-rain-235f.younglin90.workers.dev/?q=${encodeURIComponent(userText)}`);
            const data = await res.json();
            if(data.organic_results && data.organic_results.length>0){
                bestReply = data.organic_results[0].snippet || bestReply;
                confidence += 100; // slight boost if fallback used
            }
        }catch(e){}
    }

    // Emotion detection affects tone
    const emotion = detectEmotion(userText);
    if(emotion==='happy') bestReply = "😊 "+bestReply;
    if(emotion==='sad') bestReply = "😟 "+bestReply;
    if(emotion==='excited') bestReply = "🤩 "+bestReply;

    // Store in temp memory
    tempMemory.push({user:userText, ai:bestReply});
    if(tempMemory.length>maxMemory) tempMemory.shift();

    return bestReply;
}

// ====================== CHAT UI HOOK ======================
const chat=document.getElementById('chat');
const form=document.getElementById('inputForm');
const input=document.getElementById('userInput');

form.addEventListener('submit', async e=>{
    e.preventDefault();
    const userText = input.value.trim();
    if(!userText) return;
    addMessage('user',userText);
    input.value='';

    const reply = await cleverbotAI(userText);
    addMessage('ai',reply);
});

function addMessage(sender,text){
    const div=document.createElement('div');
    div.classList.add('message',sender);
    div.textContent=text;
    chat.appendChild(div);
    chat.scrollTop=chat.scrollHeight;
}

  // ====================== ADVANCED MEMORY & LEARNING ======================

// Decay factor for older memories (older exchanges have less influence)
const DECAY_RATE = 0.85;

// Function to propagate learning influence from recent exchanges
function propagateLearning(){
    for(let i=tempMemory.length-1; i>=0; i--){
        const mem=tempMemory[i];
        if(!mem.user || !mem.ai) continue;
        // Slightly adjust dataset weights (pseudo-learning)
        dataset.forEach(pair=>{
            if(pair.input.toLowerCase()===mem.user.toLowerCase()){
                // Increase relevance score (simulated learning)
                pair.weight = (pair.weight||1) + 0.1 * Math.pow(DECAY_RATE, tempMemory.length-1-i);
            }
        });
    }
}

// Function to get dataset weight for scoring (1 default)
function getPairWeight(pair){
    return pair.weight || 1;
}

// Enhanced computeWeightedScore with dynamic learning influence
function computeWeightedScoreWithLearning(userTokens, pairTokens, pair){
    let baseScore = computeWeightedScore(userTokens, pairTokens);
    const weight = getPairWeight(pair);
    return Math.min(baseScore * weight, 1000); // max score 1000
}

// Modified cleverbotAI to include learning propagation
async function cleverbotAIWithLearning(userText){
    const tokens = tokenize(userText);
    let candidates=[];

    dataset.forEach(pair=>{
        const pairTokens = tokenize(pair.input);
        let score = computeWeightedScoreWithLearning(tokens,pairTokens,pair);
        score += chainInfluence(pair.input); // add chain memory influence
        candidates.push({reply:pair.output, score});
    });

    // Sort and select best reply
    candidates.sort((a,b)=>b.score-a.score);
    let best = selectReplyWeighted(candidates);
    let bestReply = best.reply;
    let confidence = best.score;

    // Exact repeat check
    for(let i=tempMemory.length-1;i>=0;i--){
        const mem=tempMemory[i];
        if(mem.user===userText){
            bestReply = mem.ai + " (remembered)";
            confidence = 1000;
            break;
        }
    }

    // Low confidence fallback
    if(confidence<MED_CONF){
        try{
            const res = await fetch(`https://soft-rain-235f.younglin90.workers.dev/?q=${encodeURIComponent(userText)}`);
            const data = await res.json();
            if(data.organic_results && data.organic_results.length>0){
                bestReply = data.organic_results[0].snippet || bestReply;
                confidence += 100;
            }
        }catch(e){}
    }

    // Emotion adjustment
    const emotion = detectEmotion(userText);
    if(emotion==='happy') bestReply = "😊 "+bestReply;
    if(emotion==='sad') bestReply = "😟 "+bestReply;
    if(emotion==='excited') bestReply = "🤩 "+bestReply;

    // Store in temp memory
    tempMemory.push({user:userText, ai:bestReply});
    if(tempMemory.length>maxMemory) tempMemory.shift();

    // Propagate learning influence after storing
    propagateLearning();

    return bestReply;
}

// ====================== CHAT HOOK OVERRIDE ======================
// Replace previous form listener to use learning version
form.removeEventListener('submit',()=>{}); // just in case
form.addEventListener('submit', async e=>{
    e.preventDefault();
    const userText = input.value.trim();
    if(!userText) return;
    addMessage('user',userText);
    input.value='';

    const reply = await cleverbotAIWithLearning(userText);
    addMessage('ai',reply);
});

  // ====================== FINAL UTILITIES & CONTEXT ======================

// Conversation context logger (optional, can store locally)
let conversationLog = []; // {user:..., ai:..., timestamp:...}
function logConversation(userText, aiReply){
    const ts = new Date().toISOString();
    conversationLog.push({user:userText, ai:aiReply, timestamp:ts});
    // Keep only last 200 logs
    if(conversationLog.length>200) conversationLog.shift();
}

// Anti-loop detection
function preventLoops(reply){
    // If last AI message is identical, append variation
    if(tempMemory.length>1 && tempMemory[tempMemory.length-2].ai===reply){
        reply += " (…let me think a bit differently)";
    }
    return reply;
}

// Overriding addMessage to include logging
function addMessage(sender,text){
    text = preventLoops(text);
    const div=document.createElement('div');
    div.classList.add('message',sender);
    div.textContent=text;
    chat.appendChild(div);
    chat.scrollTop=chat.scrollHeight;

    // log conversation
    if(sender==='ai'){
        const lastUser = tempMemory.length>0 ? tempMemory[tempMemory.length-1].user : "";
        logConversation(lastUser,text);
    }
}

// Optional: function to clear memory
function clearMemory(){
    tempMemory.length = 0;
    conversationLog.length = 0;
}

// Optional: function to simulate learning from bulk dataset
function bulkLearn(newPairs){
    newPairs.forEach(pair=>{
        if(!dataset.find(p=>p.input===pair.input)){
            dataset.push(pair);
        }
    });
}

// ====================== END OF AI SYSTEM ======================
// Your HTML + UI + AI engine + advanced memory + learning + search fallback
// is now fully integrated. Just paste your dataset into the dataset array
// in Part 1 to make it fully functional with 1000+ entries.

// ====================== HOW TO USE ======================
// Type in the input box and press "Send". AI will:
// 1. Use weighted similarity (0-1000 scale)
// 2. Include last N exchanges for context (chain weighting)
// 3. Apply medium-match randomness
// 4. Detect emotion and adjust tone
// 5. Check memory for repeats
// 6. Use search fallback if low confidence
// 7. Log conversation and prevent simple loops
</script>
